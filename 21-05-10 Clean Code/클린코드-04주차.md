# 7. 오류 처리

- 오류 처리는 중요하다. 하지만 오류 처리 코드로 인해 프로그램 논리를 이해하기 어려워진다면 깨끗한 코드라 부르기 어렵다.

1. 오류 코드보다 예외를 사용하라
   - 코드가 깨끗해지고 뒤섞였던 개념을 분리할 수 있다.
2. Try-Catch-Finally 문부터 작성하라
   - 먼저 강제로 예외를 일으키는 테스트 케이스를 작성한 후 테스트를 통과하게 코드를 작성하라. 그러면 자연스럽게 try 블록의 트랜잭션 범위부터 구현하게 되므로 범위 내에서 트랜잭션 본질을 유지하기 쉬워진다.
3. 미확인unchecked 예외를 사용하라
   - 확인된 예외는 OCP(Open Closed Principle)를 위반한다.
     - 하위 단계에서 코드를 변경하면 상위 단계 메서드 선언부를 전부 고쳐야 한다.
4. 예외에 의미를 제공하라
   - 예외를 던질 때는 전후 상황을 충분히 덧붙여 오류가 발생한 원인과 위치를 찾기 쉽게 한다.
5. 호출자를 고려해 예외 클래스를 정의하라
   - 오류를 정의할 때 프로그래머에게 가장 중요한 관심사는 **오류를 잡아내는 방법**이 되어야 한다.
   - wrapper class
     - 외부 api를 감싸면 외부 라이브러리와 프로그램 사이에서 의존성이 크게 줄어든다.
     - 나중에 다른 라이브러리로 갈아타도 비용이 적다.
     - wrapper class에서 외부 api를 호출하는 대신 테스트 코드를 넣어주는 방법으로 프로그램을 테스트하기도 쉬워진다.
     - 특정 업체가 api를 설계한 방식에 발목 잡히지 않는다.
6. 정상 흐름을 정의하라
   - 특수 사례 폐턴(special case pattern): 클래스를 만들거나 객체를 조작해 특수 사례를 처리하는 방식. 클래스나 객체가 예외적인 상황을 캡슐화해서 처리하므로 클라이언트 코드가 예외적인 상황을 처리할 필요가 없어진다.

7. null을 반환하지 마라
   - 메서드에서 null을 반환하는 대신 예외를 던지거나 특수 사례 객체를 반환하라.
8. null을 전달하지 마라
   - 정상적인 인수로 null을 기대하는 api가 아니라면 메서드로 null을 전달하는 코드는 최대한 피한다.

- 깨끗한 코드는 읽기도 좋아야 하지만 안정성도 높아야 한다. 오류 처리를 프로그램 논리와 분리해 독자적인 사안으로 고려하면 튼튼하고 깨끗한 코드를 작성할 수 있다. 오류 처리를 프로그램 논리와 분리하면 독립적인 추론이 가능해지며 코드 유지보수성도 크게 높아진다.



# 8. 경계

1. 외부 코드 사용하기
   - 패키지 제공자나 프레임워크 제공자는 적용성을 최대한 넓히려 한다. 반면, 사용자는 자신의 요구에 집중하는 인터페이스를 바란다. 이런 긴장으로 인해 시스템 경계에서 문제가 생길 소지가 많다.
   - 경계 인터페이스를 이용할 때는 이를 이용하는 클래스나 클래스 계열 밖으로 노출되지 않도록 주의한다.
2. 경계 살피고 익히기
   - 학습 테스트: 외부 코드를 사용할 경우 간단한 테스트 케이스를 작성해 외부 코드를 익히는 것
3. 학습 테스트는 공짜 이상이다
   - 학습 테스트는 필요한 지식만을 확보하는 손쉬운 방법이고, 이해도를 높여주는 정확한 실험이다.
   - 패키지 작성자는 버그를 수정하고 기능도 추가하므로 패키지 새 버전이 나올 때마다 새로운 위험이 생긴다. 새 버전이 우리 코드와 호환되지 않으면 학습 테스트가 이 사실을 곧바로 밝혀낸다.
   - 경계 테스트가 있다면 패키지의 새 버전으로 이전하기 쉬워진다. 그렇지 않다면 낡은 버전을 필요 이상으로 오랫동안 사용하려는 유혹에 빠지기 쉽다.
4. 아직 존재하지 않는 코드를 사용하기
   - 우리가 바라는 인터페이스를 구현하면 우리 인터페이스를 전적으로 통제한다는 장점이 생긴다. 또한 코드 가독성도 높아지고 코드 의도도 분명해진다.
5. 깨끗한 경계
   - 경계에 위치하는 코드는 깔끔히 분리한다. 또한 기대치를 정의하는 테스트 케이스도 작성한다. 총제가 불가능한 외부 패키지에 의존하는 대신 통제가 가능한 우리 코드에 의존하는 편이 좋다.
   - 외부 패키지를 호출하는 코드를 가능한 줄여 경계를 관리하자.
   - 새로운 클래스로 경계를 감싸거나 ADAPTER 패턴을 사용해 우리가 원하는 인터페이스를 패키지가 제공하는 인터페이스로 변환하자.