# 11. 합성과 유연한 설계

> 합성은 전체를 표현하는 객체가 부분을 표현하는 객체를 포함해서 부분 객체의 코드를 재사용한다.
>
> 객체 합성은 클래스 상속의 대안이다. 새로운 기능을 위해 객체들을 합성한다. 객체를 합성하려면 합성할 객체들의 인터페이스를 명확하게 정의해야만 한다. 이런 스타일의 재사용을 **블랙박스 재사용(black-box reuse)**이라고 하는데, 객체의 내부는 공개되지 않고 인터페이스를 통해서만 사용되기 때문이다.

- 상속: is-a 관계
- 합성: has-a 관계



### 상속이 초래하는 문제

1. 불필요한 인터페이스 상속 문제
2. 메서드 오버라이딩의 오작용 문제
3. 부모 클래스와 자식 클래스의 동시 수정 문제

→ 상속과 비교해 합성은 안정성과 유연성이라는 장점을 제공한다.

→ 상속은 구현 상속과 인터페이스 상속으로 나눌 수 있으며, 상속에 대한 단점들은 구현 상속에 국한된다. (13장, 인터페이스 상속 참조)



- 몽키 패치(Monkey Patch): 현재 실행 중인 환경에만 영향을 미치도록 지역적으로 코드를 수정하거나 확장하는 것을 가리킨다.



### 기본 정책과 부가 정책 조합하기

- 부가 정책의 특성
  - 기본 정책의 결과에 적용된다.
  - 선택적으로 적용할 수 있다.
  - 조합 가능하다.
    - 클래스 폭발(class explosion), 조합의 폭발(combination explosion)
      - 상속의 남용으로 하나의 기능을 추가하기 위해 필요 이상으로 많은 수의 클래스를 추가해야 하는 경우
  - 부가 정책은 임의의 순서로 적용 가능하다.



### 합성 관계로 변경하기

- 합성을 사용하면 구현 시점에 정책들의 관계를 고정시킬 필요가 없으며 실행 시점에 정책들의 관계를 유연하게 변경할 수 있게 된다.
- 상속이 조합의 결과를 개별 클래스 안으로 밀어 넣는 방법이라면 합성은 조합을 구성하는 요소들을 개별 클래스로 구현한 후 실행 시점에 인스턴스를 조립하는 방법을 사용하는 것이라고 할 수 있다.
- **컴파일 의존성에 속박되지 않고 다양한 방식의 런타임 의존성을 구성할 수 있다는 것**이 합성이 제공하는 가장 커다란 장점



### 믹스인

- 믹스인(mixin): 객체를 생성할 때 코드 일부를 클래스 안에 섞어 넣어 재사용하는 기법, 추상 서브클래스(abstract subclass)
- 컴파일 시점에 필요한 코드 조각을 조합하는 재사용 방법이다.
  - cf. 합성: 실행 시점에 객체를 조합하는 재사용 방법
- 코드 재사용에 특화된 방법이면서도 상속과 같은 결합도 문제를 초래하지 않는다. 합성처럼 유연하면서도 상속처럼 쉽게 코드를 재사용할 수 있는 방법이다.
- **쌓을 수 있는 변경(stackable modification)**