# 6. 입출력과 네트워킹

### 저수준 I/O

#### 버튼을 눌러라

- 버튼에 연결된 금속 조각이 접점에 닿으면 금속 조각이 아주 잠간 **되튕겨지면서**(바운스 bounce) 접점에서 떨어진다. 접촉면이 안정될 때까지 이런 되튕김이 여러 번 발생할 수 있다. 버튼을 **디바운스**(debounce, 되튕김을 없앰)할 필요가 있다.
  - 인터럽트 핸들러에 타이머를 설정하고 그 시간이 지나면 버튼 상태를 감지
    - 최초 인터럽트 시 타이머를 설정
    - 인터럽트가 발생할 때마다 기존 타이머를 새 타이머로 재설정



#### 빛이 있으라

- 7 세그먼트(segment) 디스플레이: 7개의 LED가 숫자 8의 형태로 나열, 소수점을 표현하는 LED가 하나 더 붙어 있다.
- 8개의 LED를 처리하기 위해 16가지 전기적 접점(핀)이 필요하지만, 보통 각 LED마다 핀을 1개씩 연결하고, 핀 하나에는 모든 LED를 함께 연결한다.
- 프로세서가 충분한 수의 포트를 제공하지 못할 때 디스플레이의 애노드를 포트 A에 연결하고 캐소드를 B에 연결해서 디스플레이를 **멀티플렉스**(multiplex)한다.
- **시각의 잔상효과**(persistence of vision): 사람들이 디스플레이가 켜져 있는 것으로 인식하기 위해 짧은 시간 간격으로 디스플레이를 계속 변경하면서 세그먼트를 짧게 켰다 껐다 하면 세그먼트가 계속 켜진 것처럼 보이게 할 수 있다.



#### 빛, 동작, 그리고 상호 연동

- 장치에 버튼과 디스플레이가 함께 있는 경우 버튼과 디스플레이의 입력을 멀티플렉싱하면 핀을 덜 써도 된다.



#### 밝기 조절

- 디스플레이의 **듀티 사이클**(duty cycle): 밝기는 디스플레이가 켜져 있는 평균 시간과 관련이 있다. 하지만 듀티 사이클과 사람이 인지하는 밝기 사이의 관계는 선형이 아닐 것이다.



#### 그레이의 2^n가지 그림자

- **그레이 코드**(Grey code): 각도가 달라질 때 비트가 하나씩만 달라지는 인코딩 방법



#### 쿼드러처

- **쿼드러처 인코딩**(quadrature encoding): 2비트 그레이 코드 패턴이 여러 번 반복



#### 병렬 통신

- **병렬**(parallel): LED 컴포넌트마다 별도의 선이 있어 동시에 모든 컴포넌트를 제어할 수 있다.
- **스트로브**(strobe) 신호: 데이터의 변화만 관찰해서는 다음 문자를 알 수 없기 때문에 '지금이다'라고 알려주는 또 다른 신호를 추가해야 한다.



#### 직렬 통신

- 각 비트는 서로 다른 선을 통해 전송되지만, 각 문자는 서로 다른 시간에 나뉘어 전송된다. 마찬가지로 비트도 서로 다른 시간에 나눠서 보낼 수 있다.
- 송신하는 쪽에서 스트로브(또는 클록) 신호가 각 비트를 한 위치씩 시프트시키면서 밀려 나가는 비트를 선을 통해 내보낸다. 수신하는 쪽에서는 클록이 비트를 한 위치씩 시프트시키면서 새로 생긴 빈 자리에 선을 통해 받은 비트를 채워 넣는다.
- 송신자와 수신자가 서로 **동기화**(in sync)돼야 한다.
- 텔레타이프



#### 파동에 올라타라

- 마크-스페이스 방식의 신호는 장거리 통신에는 적합하지 않다. 이를 해결하기 위해 파동에 올라타야 한다.
- 전달하려는 신호를 바탕으로 반송파를 마크-스페이스 **파형**(waveform)처럼 변화시키는 **변조**(modulation)을 해야 한다.
  - **반송파**(carrier, 캐리어): 올라탈 파동
- 받는 쪽에서는 음향을 다시 마크-스페이스로 되돌리는 **복조**(demodulation)를 해야 한다.
- **모뎀**(modem): 변조와 복조를 수행하는 장치



#### 범용 직렬 버스

- USB(Universal Serial Bus, 범용 직렬 버스)
- USB로 연결되는 시스템은 모두 똑같은 지위가 아니며, 모든 **종단점**(endpoint)을 담당하는 **컨트롤러**(controller)가 존재한다.
- 데이터는 **패킷**(packet)으로 나뉜다. 패킷에는 **헤더**(header)와 **페이로드**(payload)가 들어 있다.
- 음향과 비디오를 **동시성 전송**(isochronous transfer)을 통해 처리할 수 있다. 종단점은 데이터 전송을 보장하기 위해 자신이 원하는 **대역폭**(bandwidth, 데이터 전송 비율)을 예약해달라고 요청할 수 있다. 충분한 대역폭이 없는 경우 컨트롤러는 이런 요청을 거부할 수 있다.



### 네트워킹

- 네트워크의 구분
  - **근거리 네트워크**(LAN, local area network)
  - **광역 네트워크**(WAN, wide area network)



#### 최근의 LAN들

- **이더넷**(Ethernet)
  - 최초의 이더넷은 반이중 시스템
  - 모든 장치가 같은 선에 연결됐으며, 각 장치의 네트워크 인터페이스(장치에서 네트워크 연결을 담당하는 부분)에는 MAC(Media Access Control, 매체 접근 제어, 맥) 주소라는 유일한 48비트 주소가 부여됐고, 요즘도 여전히 사용된다.
  - 데이터는 약 1,500바이트짜리 **프레임**(frame)이라는 이름의 패킷으로 구성된다. 프레임에는 송신 주소, 수신 주소, 오류 검증이 포함된 헤더(header)가 페이로드와 함께 들어간다.
  - **랜덤 백오프 후 재시도**(random back-off-and-retry): 둘 이상의 장치가 동시에 말하려 시도하면 패킷이 서로 엉키면서 충돌이 발생한다. 이더넷은 충돌이 발생하면 임의의 시간을 기다린 다음 다시 말하려 시도한다.
  - 요즘도 이더넷을 사용하지만 반이중 버전은 아니며 각 장치가 **라우터**(router)에 연결되며, 라우터는 어떤 장치가 어떤 선에 연결되어 있는지를 기억하고 패킷을 정확하게 배달한다.



#### 인터넷

- 여러 계층으로 이뤄진 프로토콜의 집합. 물리적 네트워크를 정의하는 아래쪽 계층을 변경해도 위쪽 계층에 영향을 끼치지 않도록 고안됐다.

> TCP/IP

**전송 제어 프로토콜/인터넷 프로토콜**(TCP/IP, Transmission Control Protocol/Internet Protocol)

- 인터넷이 사용하는 두 가지 프로토콜
- IP
  - 패킷을 한 곳에서 다른 곳으로 옮겨주며, 이 패킷을 **데이터그램**(datagram)이라고 부른다.
  - 송신자는 수신자가 메시지를 언제 받는지 알 수 없고, 메시지를 제대로 받았는지 여부도 알 수 없다.
- TCP
  - IP 위에 만들어졌고 패킷이 제대로 배달됐는지를 확실히 보장해준다.

> IP 주소

- 인터넷상의 각 컴퓨터(또는 장치)에는 **IP 주소**(IP address)라는 유일한 주소가 할당되어 있다. MAC 주소와 달리 IP주소는 하드웨어에 묶여 있지 않아서 변경될 수도 있다.
- 계층적인 시스템으로, 주소 중 일부분(주소 블록)을 누군가에게 할당하면, 그 누군가는 다시 자신에게 할당된 주소 중 일부 블록을 다른 누군가에게 할당하는 식으로 이뤄진다. 이런 할당 과정은 누군가 우리의 장치에 구체적인 주소를 할당해줄 때까지 반복된다.
- 인터넷은 대부분 **IPv4**, 즉 IP 버전 4에서 이뤄진다.
  - 32비트 주소를 사용
  - xxx.xxx.xxx.xxx 식의 **옥텟**(octet) 표기를 사용

> 도메인 이름 시스템

- **도메인 이름 시스템**(DNS, Domain Name System): 이름을 주소로 바꿔준다. (Whitehouse.gov → 23.15.93.167)

> 월드 와이드 웹

- SMTP(Simple Mail Transfer Protocol, 단순 우편 전달 프로토콜): 전자 우편 시스템이 작동하는 기반 프로토콜
- HTTP(HyperText Transfer Protocol, **하이퍼텍스트 전송 프로토콜**), HTTPS(HTTP Secure)
  - 하이퍼텍스트: 링크가 붙은 텍스트
  - HTTP 표준은 **웹 브라우저**(web browser)가 **웹 서버**(web server)와 상호작용하는 방법을 정의
  - **URL**(Uniform Resource Locator)에 따라 웹 페이지를 얻을 수 있다.



### 아날로그 처리 방법

- 우리가 실제로 겪는 소리나 빛은 연속적이지만 컴퓨터에는 연속적인 대상을 저장할 방법이 없기 때문에 데이터의 **샘플**(sample)을 취해야 한다. 샘플을 취한다는 말(샘플링)은 시간이나 공간상 일정한 간격으로 값을 읽어야 한다는 뜻이다. 저장한 데이터를 다시 영상이나 빛으로 보여주려면 샘플링 데이터로부터 아날로그(연속적인) 신호를 다시 만들어내야 한다.



#### 디지털을 아날로그로 변환

- DA 변환기(digital-to-analog converter, D/A, DAC): 디지털을 아날로그로 바꾸는 변환기



#### 아날로그를 디지털로 변환

- AD 변환기(analog-to-digital converter, A/D, ADC): 아날로그를 디지털로 바꾸는 변환기
- 아날로그 신호의 값을 흔들리지 않게 안정적으로 잡아내야 함 → **샘플 앤드 홀드**(sample and hold)라는 회로를 사용
- 어떤 문턱값과 신호를 비교해야 함 → **비교기**(comparator)라는 회로를 사용



#### 디지털 오디오

- 일차원으로 **샘플링**(sampling)을 하면 오디오를 디지털화할 수 있다. 일정한 샘플링 **주파수**(sampling frequency)로 **사각파**(square wave)를 얻을 수 있고, **상승 에지**(rising edge)마다 A/D를 사용해 신호의 높이를 기록할 수 있다.
- 샘플이 많지 않아도 **푸리에 변환**(Fourier transform)을 통해 파를 재구성할 수 있다.
- 오디오 압축
  - **무손실 압축**(lossless compression): 원래 데이터를 그대로 유지, 원래 데이터 크기의 절반 정도로밖에 크기를 줄여주지 못한다.
  - **손실 압축**(lossy compression): **FLAC**(**무료 무손실 오디오 코덱**, Free Lossless Audio Codec), MP3, AAC, Ogg
    - **코덱**(codec): 코더-디코더(coder-decoder), 어떤 대상을 한 코딩 시스템에서 다른 코딩 시스템으로 변환해주거나 반대 방향으로 변환해주는 장치(소프트웨어 또는 하드웨어)



#### 디지털 이미지

- 2차원 공간을 샘플링해야 하기 때문에 오디오보다 더 복잡하다.
- 디지털 이미지는 그림 요소(picture element) 또는 **픽셀**(pixel)로 이뤄진 직사각형 배열로 표현된다.
- **가산**(additive) 혼합 색 시스템을 사용해 색을 표현: 빨간색, 녹색, 파란색
- **포인트 샘플링**(point sampling): 정사각형 전체의 색을 기록하는 대신 각 정사각형 중심 점의 색을 기록한다.
- **슈퍼샘플링**(super sampling): 한 정사각형 안에서 여러 지점의 색을 얻어서 평균을 낸다.



#### 비디오

- 2차원 이미지를 일정 시간 간격으로 샘플링한 시퀀스
- **움직임 보상**(motion compensation): 프레임이 변할 때 변경된 영역의 데이터만 필요하다면 더 적은 데이터를 저장하거나 송신할 수 있다.
- 데이터에 **키프레임**(keyframe)을 추가하는 방식으로 데이터를 복구할 수 있댜.
  - 키프레임은 완전한 이미지이므로, 오염된 데이터가 누적되면서 생긴 이미지가 손상된 경우라도 다음 키프레임에 전체 이미지를 복구할 수 있다.



### 휴먼 인터페이스 장치

#### 터미널

- 

