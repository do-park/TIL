### 4. 컴포넌트 원칙

### 12. 컴포넌트

- 배포 단위, 시스템의 구성 요소로 배포할 수 있는 가장 작은 단위

- 컴포넌트가 마지막에 어떤 형태로 배포되든, 잘 설계된 컴포넌트라면 반드시 독립적으로 배포 가능한, 따라서 독립적으로 개발 가능한 능력을 갖춰야 한다.

  

### 13. 컴포넌트 응집도

- 컴포넌트 응집도와 관련된 세 가지 원칙
  - REP: 재사용/릴리스 등가 원칙 Reuse/Release Equivalence Principle
  - CCP: 공통 폐쇄 원칙 Common Closure Principle
  - CRP: 공통 재사용 원칙 Common Reuse Principle
- REP
  - 재사용 단위는 릴리스 단위와 같다.
  - 단일 컴포넌트는 응집성 높은 클래스와 모듈들로 구성되어야 함을 뜻한다. 컴포넌트를 구성ㄹ하는 모든 모듈은 서로 공유하는 중요한 테마나 목적이 있어야 한다.
  - 이 원칙을 어기면 '이치에 맞지' 않게 된다.
- CCP
  - 동일한 시점에 변경되는 클래스를 같은 컴포넌트로 묶어라. 서로 다른 시점에 다른 이유로 변경되는 클래스는 다른 컴포넌트로 분리하라.
  - 발생할 가능성이 있거나 과거에 발생했던 대다수의 공통적인 변경에 대해서 클래스가 닫혀 있도록 설계한다.
  - SRP와의 유사성
    - CCP는 컴포넌트 수준의 SRP다.
    - 동일한 시점에 동일한 이유로 변경되는 것들을 한데 묶어라. 서로 다른 시점에 다른 이유로 변경되는 것들은 서로 분리하라.
- CRP
  - 컴포넌트 사용자들에게 필요하지 않는 것에 의존하게 강요하지 말라.
  - 클래스와 모듈을 어느 컴포넌트에 위치시킬지 결정할 때 도움이 되는 원칙. CRP에서는 같이 재사용되는 경향이 있는 클래스와 모듈들은 같은 컴포넌트에 포함해야 한다고 말한다.
  - 동일한 컴포넌트로 묶어서는 안 되는 클래스가 무엇인지도 알려준다.
  - ISP와의 관계
    - CRP는 ISP(인터페이스 분리 원칙)의 포괄적인 버전이다.
    - 필요하지 않은 것에 의존하지 말라.
- 컴포넌트 응집도에 대한 균형 다이어그램 (책 113쪽)
  - REP, CCP: 포함inclusive 원칙. 즉 두 원칙은 컴포넌트를 더욱 크게 만든다.
  - CRP: 배제exclusive 원칙. 컴포넌트를 더욱 작게 만든다.



### 14. 컴포넌트 결합

- ADP: 의존성 비순환 원칙

  - 컴포넌트 의존성 그래프에 순환(cycle)이 있어서는 안 된다.

  **주 단위 빌드(Weekly Build)**

  - 중간 규모의 프로젝트에서 흔하게 사용
  - 일주일의 첫 4일 동안은 서로를 신경 쓰지 않는다.
  - 금요일이 되면 변경된 코드를 모두 통합하여 시스템을 빌드한다.

  **순환 의존성 제거하기**

  - 개발 환경을 릴리스 가능한 컴포넌트 단위로 분리한다.
  - 성공적으로 동작하려면 컴포넌트 사이의 의존성 구조를 관리해야 한다.

  **순환이 컴포넌트 의존성 그래프에 미치는 영향**

  - 의존성 그래프에 순환이 생기면 컴포넌트를 분리하기가 어려워지며 에러도 쉽게 발생한다. 게다가 모듈의 개수가 많아짐에 따라 빌드 관련 이슈는 기하급수적으로 증가한다.
  - 의존성 그래프에 순환이 생기면 컴포넌트를 어떤 순서로 빌드해야 올바르맂 파ㅏㄱ하기가 힘들어진다.
  
  **순환 끊기**
  
  - 의존성 역전 원칙(DIP) 적용
  - 두 컴포넌트가 모두 의존하는 새로운 컴포넌트를 만들고, 두 컴포넌트라 모두 의존하는 클래스들을 새로운 컴포넌트로 이동 시킨다.
  
  **흐트러짐(Jitters)**
  
  - 애플리케이션이 성장함에 따라 컴포넌트 의존성 구조는 서서히 흐트러지며 또 성장한다. 따라서 의존성 구조에 순환이 발생하는지를 항상 관찰해야 한다. 순환이 발생하면 어떤 식으로든 끊어야 한다. 이 말은 새로운 컴포넌트를 생성하거나 의존성 구조가 더 커질 수도 있음을 의미한다.
  
- 하향식(top-down) 설계

  - 컴포넌트 구조는 하향식으로 설계될 수 없다. 컴포넌트는 시스템에서 가장 먼저 설계할 수 있는 대상이 아니며, 오히려 시스템이 성장하고 변경될 때 함께 진화한다.

- SDP: 안정된 의존성 원칙

  - 안정성의 방향으로(더 안정된 쪽에) 의존하라.
  - 변경이 쉽지 않은 컴포넌트가 변동이 예상되는 컴포넌트에 의존하게 만들어서는 절대로 안 된다. 한번 의존하게 되면 변동성이 큰 컴포넌트도 결국 변경이 어려워진다.

  **안정성(stability)**

  - 소프트웨어 컴포넌트를 변경하기 어렵게 만드는 확실한 방법 하나는 수많은 다른 컴포넌트가 해당 컴포넌트에 의존하게 만드는 것이다.

  **안정성 지표**

  - Fan-in: 안으로 들어오는 의존성. 컴포넌트 내부의 클래스에 의존하는 컴포넌트 외부의 클래스 개수를 나타낸다.
  - Fan-out: 바깥으로 나가는 의존성. 컴포넌트 외부의 클래스에 의존하는 컴포넌트 내부의 클래스 개수를 나타낸다.
  - I(불안정성): I = Fan-out / (Fan-in + Fan-out), [0, 1], 0과 가까울수록 안정적, 1과 가까울수록 불안정적이다.

  **모든 컴포넌트가 안정적이어야 하는 것은 아니다**

  - 모든 컴포넌트가 안정적이라면 변경이 불가능하고, 이는 바람직한 상황이 아니다.

- SAP: 안정된 추상화 원칙