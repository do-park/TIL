# 4. 실용주의 편집증

> 여러분은 완벽한 소프트웨어를 만들 수 없다.

- **실용주의 프로그래머는 자기 자신 역시 믿지 않는다.**
- 그러므로 실용주의 프로그래머는 자신의 실수에 대비한 방어책을 마련한다.



### 23. 계약에 의한 설계

- 계약contract
  - 계약은 자신과 상대편의 권리 및 책임을 정의한다. 그뿐만 아니라 한쪽이 계약을 어겼을 경우의 대응도 계약 사항에 포함된다.

#### DBC

- 계약에 의한 설계Design By Contract, DBC
- 프로그램의 정확성을 보장하기 위해 소프트웨어 모듈의 권리와 책임을 문서화하고 합의하는 데에 초점을 맞춘다.
- 정확한 프로그램이란 자신이 하는 일이라고 주장하는 것보다 많지도 적지도 않게 딱 그만큼만 하는 프로그램이다.
- 소프트웨어 시스템의 모든 함수와 메서드는 **뭔가를 한다.** 그 **뭔**가를 시작하기 전에 해당 함수는 세상의 상태에 대해 어떤 전제 조건을 갖고 있을 테고, 루틴이 끝난 후에는 세상의 상태가 어떠할 것이라고 선언할 수 있을 것이다.
- 전제와 선언
  - 선행 조건precondition
    - 루틴이 호출되기 위해 참이어야 하는 것. 즉, 루틴의 요구 사항.
    - 루틴의 선행 조건이 위반된 경우에는 루틴이 호출되어서는 안 된다. 제대로 된 데이터를 전달하는 것은 호출하는 쪽의 책임이다.
  - 후행 조건postcondition
    - 루틴이 자기가 할 것이라고 보장하는 것. 즉, 루틴이 완료되었을 때 세사으이 상태.
    - 루틴에 후행 조건이 있다는 것은 곧 루틴이 **종국에는** 종료될 것이라는 걸 의미한다. 무한 반복은 허용되지 않는다.
  - 클래스 불변식class invariant
    - 호출자의 입장에서 볼 때는 이 조건이 언제나 참인 것을 클래스가 보장한다. 루틴의 내부 처리 도중에는 불변식이 참이 아닐 수도 있지만, 루틴이 끝나고 호출자로 제어권이 반환되는 시점에는 불변식이 참이 되어야 한다. (따라서 클래스는 불변식에 관여하는 데이터 멤버의 제한 없는 쓰기를 허용할 수 없다.)
- 루틴과 그 루틴을 호출하려는 코드 간의 계약
  - 만약 호출자가 루틴의 모든 선행 조건을 충족한다면 해당 루틴은 종료 시 모든 후행 조건과 불변식이 참이 되는 것을 보장한다.

> 계약으로 설계하라.

- 게으름뱅이lazy 코드
  - 시작하기 전에 자신이 수용할 것은 엄격하게 확인하고, 내어 줄 것에 대해서는 최소한도를 약속하라.

#### DBC 구현

- DBC는 설계 기법이다. 자동 검사가 없더라도 계약을 코드에 주석이나 단위 테스트로 넣어둘 수 있고, 여전히 실질적인 소득이 있다.
- **단정문**
  - 컴파일러가 대신 계약을 검사하도록 조건문을 실행 시점에 확인하는 '단정문'을 사용할 수 있다.
  - 단정문으로 DBC로 가능한 모든 것을 할 수는 없다.

#### DBC와 일찍 멈추기

- 