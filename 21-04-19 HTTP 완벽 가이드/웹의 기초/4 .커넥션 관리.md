# 4 .커넥션 관리

### 4.1 TCP 커넥션

전 세계 모든 HTTP 통신은 TCP/IP를 통해 이루어지며, 일단 커넥션이 맺어지면 클라이언트와 서버 컴퓨터 간에 주고받는 메시지들은 손실 혹은 손상되거나 순서가 바뀌지 않고 안전하게 전달된다.

1. 신뢰할 수 있는 데이터 전송 통로인 TCP

2. TCP 스트림은 세그먼트로 나뉘어 IP 패킷을 통해 전송된다

   - HTTP는 IP, TCP, HTTP로 구성된 프로토콜 스택의 최상위 계층

   - |                    |                   | HTTP               | 애플리케이션 계층 |
     | ------------------ | ----------------- | ------------------ | ----------------- |
     | HTTP               | 애플리케이션 계층 | TLS or SSL         | 보안 계층         |
     | TCP                | 전송 계층         | TCP                | 전송 계층         |
     | IP                 | 네트워크 계층     | IP                 | 네트워크 계층     |
     | Network Interfaces | 데이터 링크 계층  | Network Interfaces | 데이터 링크 계층  |
     | HTTP               |                   | HTTPS              |                   |

   - HTTP가 메시지를 전송하고자 할 경우, 현재 연결되어 있는 TCP 커넥션을 통해서 메시지 데이터의 내용을 순서대로 보낸다. TCP는 세그먼트라는 단위로 데이터 스트림을 잘게 나누고, 세그먼트를 IP 패킷이라 불리는 봉투에 담아 인터넷을 통해 데이터를 전달한다.

   - IP 패킷의 구성

     - IP 패킷 헤더(보통 20바이트)
     - TCP 세그먼트 헤더(보통 20바이트)
     - TCP 데이터 조각(0 혹은 그 이상의 바이트)

3. TCP 커넥션 유지하기

   - 컴퓨터는 항상 TCP 커넥션을 여러 개 가지고 있다. TCP는 포트 번호를 통해서 이런 여러 개의 커넥션을 유지한다.
   - TCP 커넥션은 <발신지 IP 주소, 발신지 포트, 수신지 IP 주소, 수신지 포트> 로 식별한다.

4. TCP 소켓 프로그래밍

   - 소켓 API를 사용하면 TCP 종단(endpoint) 데이터 구조를 생성하고, 원격 서버의 TCP 종단에 그 종단 데이터 구조를 연결하여 데이터 스트림을 읽고 쓸 수 있다.
   - TCP API는 기본적인 네트워크 프로토콜의 핸드셰이킹, 그리고 TCP 데이터 스트림과 IP 패킷 간의 분할 및 재조립에 대한 모든 세부사항을 외부로부터 숨긴다.

5. TCP의 성능에 대한 고려

   - HTTP는 TCP 바로 위에 있는 계층이기 때문에 HTTP 트랜잭션의 성능은 그 아래 계층인 TCP 성능에 영향을 받는다.