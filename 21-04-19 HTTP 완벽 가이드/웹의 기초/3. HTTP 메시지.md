### 3) HTTP 메시지

> HTTP가 인터넷의 배달원이라면, HTTP 메시지는 무언가를 담아 보내는 소포와 같다.

#### 3.1 메시지의 흐름

- HTTP  메시지: HTTP 애플리케이션 간에 주고받은 데이터의 블록들. 메시지의 내용과 의미를 설명하는 텍스트 메타 정보로 시작하고 그 다음에 선택적으로 데이터가 올 수 있다.

1. 메시지는 원 서버 방향을 인바운드로 하여 송신된다.
   - HTTP는 인바운드와 아웃바운드라는 용어를 트랜잭션 방향을 표현하기 위해 사용한다. 메시지가 원 서버로 향하는 것은 인바운드로 이동하는 것이고, 모든 처리가 끝난 뒤에 메시지가 사용자 에이전트로 돌아오는 것은 아웃바운드로 이동하는 것이다.
2. 다운스트림으로 흐르는 메시지
   - 요청 메시지냐 응답 메시지냐에 관계없이 모든 메시지는 다운스트림으로 흐른다. 메시지의 발송자는 수신자의 업스트림이다.

#### 3.2 메시지의 각 부분

- HTTP 메시지는 단순한, 데이터의 구조화된 블록이다.
- 각 메시지는 클라이언트로부터의 요청이나 서버로부터의 응답 중 하나를 포함한다. 메시지는 시작줄, 헤더 블록, 본문 이렇게 세 부분으로 이루어진다. 시작줄은 이것이 어떤 메시지인지를 서술하며, 헤더 블록은 속성을, 본문은 데이터를 담고 있다. 본문은 아예 없을 수도 있다.
- 시작줄과 헤더
  - 줄 단위로 분리된 아스키 문자열
  - 각 줄은 캐리지 리턴과 개행 문자로 구성된 두 글자의 줄바꿈 문자열으로 끝난다. 이 줄바꿈 문자열을 CRLF라고 쓴다.
- 엔터티 본문이나 메시지 본문(본문)
  - 단순히 선택적인 데이터 덩어리
  - 텍스트나 이진 데이터를 포함할 수도 있고 그냥 비어있을 수도 있다.

1. 메시지 문법

   - 모든 HTTP 메시지는 요청 메시지나 응답 메시지로 분류된다. 요청 메시지는 웹 서버에 어떤 동작을 요구한다. 응답 메시지는 요청의 결과를 클라이언트에게 돌려준다. 요청과 응답 모두 기본적으로 구조가 같다.

   - 요청 메시지의 형식

     ```
     <메서드> <요청 URL> <버전>
     <헤더>
     
     <엔터티 본문>
     ```

   - 응답 메시지의 형식

     ```
     <버전> <상태 코드> <사유 구절>
     <헤더>
     
     <엔터티 본문>
     ```

   - **메서드**: 클라이언트 측에서 서버가 리소스에 대해 수행해주길 바라는 동작. 'GET', 'HEAD', 'POST'와 같이 한 단어로 되어 있다.

   - **요청 URL**: 요청 대상이 되는 리소스를 지칭하는 완전한 URL 혹은 URL의 경로 구성요소. 완전한 URL이 아닌 URL의 경로 구성요소라고 해도, 클라이언트가 서버와 직접 대화하고 있고 경로 구성요소가 리소스를 가리키는 절대 경로이기만 하면 대체로 문제가 없다. 서버는URL에서 생략된 호스트/포트가 자신을 가리키는 것으로 간주할 것이다.
   
   - **버전**: `HTTP/<메이저>.<마이너>` 메이저와 마이너는 모두 정수다.
   
   - **상태 코드**: 요청 중에 무엇이 일어났는지 설명하는 세 자리의 숫자. 첫 번째 자릿수는 상태의 일반적인 분류('성공', '에러' 등)
   
   - **사유 구절(reason-phrase)**: 숫자로 된 상태 코드의 의미를 사람이 이해할 수 있게 설명해주는 짧은 문구. 상태 코드 이후부터 줄바꿈 문자열까지.
   
   - **헤더들**: 이름, 콜론(:), 선택적인 공백, 값, CRLF가 순서대로 나타내는 0개 이상의 헤더들. 이 헤더의 목록은 빈 줄(CRLF)로 끝나 헤더 목록의 끝과 엔터티 본문의 시작을 표시한다. HTTP/1.1과 같은 몇몇 버전의 HTTP는 요청이나 응답에 어떤 특정 헤더가 포함되어야만 유효한 것으로 간주한다.
   
   - **엔터티 본문**: 임의의 데이터 블록을 포함. 모든 메시지가 엔터티 본문을 갖는 것은 아님. (CRLF로 끝나는 메시지도 존재) 헤더나 엔터티 본문이 없더라도 HTTP 헤더의 집합은 항상 빈 줄(CRLF)로 끝나야 함.
   
2. 시작줄

   - 모든 HTTP 메시지는 시작줄로 시작한다. 요청 메시지의 시작줄은 무엇을 해야 하는지, 응답 메시지의 시작줄은 무슨 일이 일어났는지 말해준다.

   - **요청줄**
     
     - 요청 메시지는 서버에게 리소스에 대해 무언가를 해달라고 부탁한다. 요청 메시지의 시작줄, 혹은 요청줄에는 서버에서 어떤 동작이 일어나야 하는지 설명해주는 메서드와 그 동작에 대한 대상을 지칭하는 요청 URL이 들어있다. 또한 요청줄은 클라이언트가 어떤 HTTP 버전으로 말하고 있는지 서버에게 알려주는 HTTP 버전도 포함한다.
     - 이 모든 필드는 공백으로 구분된다.
     
   - **응답줄**

     - 응답 메시지는 수행 결과에 대한 상태 정보와 결과 데이터를 클라이언트에게 돌려준다. 응답 메시지의 시작줄 혹은 응답줄에는 응답 메시지에서 쓰인 HTTP의 버전, 숫자로 된 상태 코드, 수행 상태에 대해 설명해주는 텍스트로 된 사유 구절이 들어 있다.
     - 이 모든 필드는 공백으로 구분된다.

   - **메서드**

     - 요청의 시작줄은 메서드로 시작하며, 서버에서 무엇을 해야 하는지 말해준다.

     - HTTP 명세는 공통 요청 메서드의 집합을 정의한다.

     - 많이 쓰이는 HTTP 메서드

       | 메서드  | 설명                                                    | 메시지 본문 유무 |
       | ------- | ------------------------------------------------------- | ---------------- |
       | GET     | 서버에서 어떤 문서를 가져온다.                          | 없음             |
       | HEAD    | 서버에서 어떤 문서에 대해 헤더만 가져온다.              | 없음             |
       | POST    | 서버가 처리해야 할 데이터를 보낸다.                     | 있음             |
       | PUT     | 서버에 요청 메시지의 본문을 저장한다.                   | 있음             |
       | TRACE   | 메시지가 프락시를 거쳐 서버에 도달하는 과정을 추적한다. | 없음             |
       | OPTIONS | 서버가 어떤 메서드를 수행할 수 있는지 확인한다.         | 없음             |
       | DELETE  | 서버에서 문서를 제거한다.                               | 없음             |

       - HTTP는 쉽게 확장할 수 있도록 설계되었기 때문에, 다른 서버는 그들만의 메서드를 추가로 구현했을 수도 있다. → 확장 메서드

   - **상태 코드**

     - 클라이언트에게 무엇이 일어났는지 말해준다. 상태 코드는 응답의 시작줄에 위치한다.

     - 각 응답 메시지의 시작줄에 담겨 반환된다.

     - 사유 구절은 사람에게 쉽게 읽히는 한편, 숫자로 된 코드는 프로그램이 에러를 처리하기 쉽다.

     - 상태 코드의 종류

       | 전체 범위 | 정의된 범위 | 분류            |
       | --------- | ----------- | --------------- |
       | 100-199   | 100-101     | 정보            |
       | 200-299   | 200-206     | 성공            |
       | 300-399   | 300-305     | 리다이렉션      |
       | 400-499   | 400-415     | 클라이언트 에러 |
       | 500-599   | 500-505     | 서버 에러       |

     - 많이 쓰는 상태 코드들

       | 상태 코드 | 사유 구절    | 의미                                               |
       | --------- | ------------ | -------------------------------------------------- |
       | 200       | OK           | 성공! 요청한 모든 데이터는 응답 본문에 들어있다.   |
       | 401       | Unauthorized | 사용자 이름과 비밀번호를 입력해야 한다.            |
       | 404       | Not Found    | 서버는 요청한 URL에 해당하는 리소스를 찾지 못했다. |

   - **사유 구절**

     - 응답 시작줄의 마지막 구성요소. 상태 코드에 대한 글로 된 설명을 제공
     - 상태 코드와 일대일로 대응. 애플리케이션 개발자들이 그들의 사용자에게 요청 중에 무슨 일이 일어났는지를 알려주기 위해 넘겨줄 수 있는, 상태 코드의 사람이 이해하기 쉬운 버전

   - **버전 번호**

     - HTTP/x.y 형식으로 요청과 응답 메시지 양쪽에 모두 기술
     - HTTP 애플리케이션들이 자신이 따르는 프로토콜의 버전을 상대방에게 말해주기 위한 수단
     - 버전 번호는 어떤 애플리케이션이 지원하는 가장 높은 HTTP 버전을 가리킨다.
       - 버전 번호는 분수로 다루어지지 않는다. 버전의 각 숫자는 각각 분리된 숫자로 다루어진다. 따라서 어느 쪽이 큰지 HTTP 버전을 비교할 때 각 숫자는 반드시 따로따로 비교해야 한다.
         - HTTP/2.22 > HTTP/2.3: 22가 3보다 크기 때문

3. 헤더